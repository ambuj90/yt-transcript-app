{% extends "base.html" %} {% block content %}

<div class="container">
  <div class="card shadow-lg p-4 bg-white rounded">
    <h1 class="text-center text-primary mb-3">YouTube Transcript Generator</h1>
    <p class="text-center text-muted">
      Convert YouTube videos into text easily.
    </p>

    <!-- âœ… Input with Bootstrap -->
    <div class="input-group mb-3">
      <input
        type="text"
        id="video-url"
        class="form-control"
        placeholder="Paste YouTube Video URL Here..."
        required
      />
      <button class="btn btn-primary" onclick="fetchTranscript()">
        Get Transcript
      </button>
    </div>

    <!-- âœ… Language Selection -->
    <div class="mb-3">
      <label class="form-label">Choose Language:</label>
      <select id="language-picker" class="form-select">
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>
    </div>

    <!-- âœ… Buttons Row -->
    <div class="text-center">
      <button class="btn btn-success me-2" onclick="downloadTXT()">
        Download TXT
      </button>
      <button class="btn btn-danger" onclick="downloadPDF()">
        Download PDF
      </button>
    </div>

    <!-- âœ… Loading Spinner -->
    <div id="loading-spinner" class="text-center mt-3" style="display: none">
      <div class="spinner-border text-primary" role="status"></div>
    </div>

    <!-- âœ… Error Message -->
    <p id="error-message" class="text-danger mt-3"></p>

    <!-- âœ… Collapsible Transcript Output -->
    <button
      class="btn btn-secondary mt-3"
      data-bs-toggle="collapse"
      data-bs-target="#transcript-container"
    >
      ðŸ“œ Show/Hide Transcript
    </button>

    <div
      id="transcript-container"
      class="collapse mt-3 p-3 border rounded bg-light"
    >
      <p id="transcript-text" class="text-muted"></p>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  async function fetchTranscript() {
    const videoUrl = document.getElementById("video-url").value;
    document.getElementById("error-message").innerText = "";
    document.getElementById("transcript-container").innerText = "";

    if (!videoUrl) {
      document.getElementById("error-message").innerText =
        "Please enter a valid YouTube video URL.";
      return;
    }

    try {
      const response = await fetch(
        `/api/transcript/?videoUrl=${encodeURIComponent(videoUrl)}`
      );
      const data = await response.json();
      if (data.transcript) {
        document.getElementById("transcript-container").innerText =
          data.transcript;
      } else {
        document.getElementById("error-message").innerText =
          "Failed to fetch transcript.";
      }
    } catch (error) {
      document.getElementById("error-message").innerText =
        "An error occurred. Try again.";
    }
  }

  // âœ… Prevent downloading if no video link is entered
  function downloadTXT() {
    const videoUrl = document.getElementById("video-url").value;
    if (!videoUrl) {
      alert("Please enter a YouTube video URL before downloading.");
      return;
    }

    const transcript = document.getElementById("transcript-text").innerText;
    if (!transcript) {
      alert("No transcript available to download.");
      return;
    }

    const blob = new Blob([transcript], { type: "text/plain;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "transcript.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  // âœ… Prevent downloading PDF if no video link is entered
  function downloadPDF() {
    const videoUrl = document.getElementById("video-url").value;
    if (!videoUrl) {
      alert("Please enter a YouTube video URL before downloading.");
      return;
    }

    const transcript = document.getElementById("transcript-text").innerText;
    if (!transcript) {
      alert("No transcript available to download.");
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("YouTube Transcript", 10, 10);
    const lines = doc.splitTextToSize(transcript, 180);
    let y = 20;
    lines.forEach((line) => {
      doc.text(line, 10, y);
      y += 7;
    });
    doc.save("transcript.pdf");
  }
</script>

{% endblock %}
